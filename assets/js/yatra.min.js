var YatraFrontend=function(r){return{init:function(){this.cacheDom(),this.bindEvents(),this.initLib()},cacheDom:function(){this.$book_now=r(".ayatra-book-now-btn"),this.$yatra_update_cart=r(".yatra_update_cart")},bindEvents:function(){var n=this;this.$book_now.on("click",function(t){t.preventDefault();var a=r(this).attr("data-tour-id"),e=r(this).closest(".yatra-book-btn-wrapper").find(".yatra_number_of_person").val();a<1||e<1||n.bookTour(a,e,r(this))}),r("body").on("click",".yatra_update_cart",function(t){t.preventDefault();var a=r(this).closest("form").serialize();n.update_cart(a,r(this))}),r("body").on("click","table.yatra_cart_table input.number_of_person",function(t){t.preventDefault(),r(this).closest(".yatra_cart_table").find(".yatra_update_cart").removeAttr("disabled")}),r("body").on("click",".yatra-itinerary-list-item .itinerary-heading svg, .yatra-itinerary-list-item .itinerary-heading .fa, .yatra-faq-list-item .faq-heading svg, .yatra-faq-list-item .faq-heading .fa",function(){r(this).hasClass("fa-minus")?n.toggleYatraList(r(this),"close"):n.toggleYatraList(r(this),"open")}),r("body").on("click",".yatra-tab-content .tab-title svg, .yatra-tab-content .tab-title .fa",function(){var t=r(this),a=r('<span class=""/>'),e=t.closest("h3");t.hide();var i="close";t.hasClass("fa-minus")?(i="close",a.addClass("fa fa-plus")):(i="open",a.addClass("fa fa-minus")),r.each(t.closest(".yatra-tab-content").find("ul.yatra-list li.yatra-list-item .yatra-heading"),function(){var t=r(this).find(".icon");0<t.length&&n.toggleYatraList(t,i)}),e.append(a),t.remove()})},initLib:function(){"undefined"!=typeof r().select2&&r(".yatra-select2").select2(),"undefined"!=typeof r().datepicker&&r(".yatra-date").datepicker()},toggleYatraList:function(t,a){"open"==a?this.listToggleOpen(t):this.listToggleClose(t)},listToggleOpen:function(t){t.closest("li.yatra-list-item").find(".yatra-content").slideDown("slow");var a=r('<span class="icon fa fa-minus"/>'),e=t.closest("h4");t.hide(),e.append(a),t.remove()},listToggleClose:function(t){t.closest("li.yatra-list-item").find(".yatra-content").slideUp("slow");var a=r('<span class="icon fa fa-plus"/>'),e=t.closest("h4");t.hide(),e.append(a),t.remove()},addLoading:function(t){"a"===t[0].tagName.toLowerCase()?t.text(t.attr("data-loading-text")):t.val(t.attr("data-loading-text"))},removeLoading:function(t){"a"===t[0].tagName.toLowerCase()?t.text(t.attr("data-text")):t.val(t.attr("data-text"))},update_cart:function(t,a){var e=a.closest("form.yatra-cart-form"),i=this;r.ajax({type:"POST",url:yatra_params.ajax_url,data:t,beforeSend:function(){i.table_loading(a)},success:function(t){!0===t.success&&(e.find(".yatra-cart-table-wrapper").find("table.yatra_cart_table").remove(),e.find(".yatra-cart-table-wrapper").append(t.data)),e.find(".yatra-overlay").remove()},complete:function(){e.find(".yatra-overlay").remove()}})},table_loading:function(t){t.closest("form").append('<div class="yatra-overlay"></div>')},bookTour:function(t,a,e){var i=this,n=yatra_params.booking_params,s={action:n.booking_action,yatra_nonce:n.booking_nonce,tour_id:t,number_of_person:a};r.ajax({type:"POST",url:yatra_params.ajax_url,data:s,beforeSend:function(){i.addLoading(e)},success:function(t){!0===t.success&&(window.location=t.data.cart_page_url)},complete:function(){i.removeLoading(e)}})}}}(jQuery),YatraTabs=function(e){return{init:function(){this.cacheDom(),this.setupAria(),this.bindEvents()},cacheDom:function(){this.$el=e(".yatra-tabs"),this.$tabList=this.$el.find("ul.yatra-tab-wrap"),this.$tab=this.$tabList.find("li.item"),this.$tabFirst=this.$tabList.find("li.item:first-child a"),this.$tabLink=this.$tabList.find("li.item > a"),this.$tabPanel=this.$el.find("section"),this.$tabPanelFirstContent=this.$el.find("section > *:first-child"),this.$tabPanelFirst=this.$el.find("section:first-child"),this.$tabPanelNotFirst=this.$el.find("section:not(:first-of-type)")},bindEvents:function(){this.$tabLink.on("click",function(){this.changeTab()}.bind(this)),this.$tabLink.on("keydown",function(){this.changeTabKey()}.bind(this))},changeTab:function(){var t=e(event.target);event.preventDefault(),this.removeTabFocus(),this.setSelectedTab(t),this.hideAllTabPanels(),this.setSelectedTabPanel(t)},changeTabKey:function(){var t=e(event.target),a=this.setKeyboardDirection(t,event.keyCode);a.length&&(this.removeTabFocus(t),this.setSelectedTab(a)),this.hideAllTabPanels(),this.setSelectedTabPanel(e(document.activeElement))},hideAllTabPanels:function(){this.$tabPanel.attr("aria-hidden","true")},removeTabFocus:function(t){(t||e('[role="tab"]')).attr({tabindex:"-1","data-aria-selected":null}).closest("li").removeClass("active")},selectFirstTab:function(){this.$tabFirst.attr({"data-aria-selected":"true",tabindex:"0"}).closest("li").addClass("active")},setupAria:function(){this.$tabList.attr("role","tablist"),this.$tab.attr("role","presentation"),this.$tabLink.attr({role:"tab",tabindex:"-1"}),this.$tabLink.each(function(){var t=e(this);t.attr("aria-controls",t.attr("href").substring(1))}),this.$tabPanel.attr({role:"tabpanel"}),this.$tabPanelFirstContent.attr({tabindex:"0"}),this.$tabPanelNotFirst.attr({"aria-hidden":"true"}),this.selectFirstTab()},setKeyboardDirection:function(t,a){var e=t.parents("li").prev().children('[role="tab"]'),i=t.parents("li").next().children('[role="tab"]');switch(a){case 37:return e;case 39:return i;default:return!1}},setSelectedTab:function(t){t.attr({"data-aria-selected":!0,tabindex:"0"}).focus().closest("li").addClass("active")},setSelectedTabPanel:function(t){this.$el.find("#"+t.attr("aria-controls")).attr("aria-hidden",null)}}}(jQuery);jQuery(document).ready(function(){YatraFrontend.init(),YatraTabs.init()});